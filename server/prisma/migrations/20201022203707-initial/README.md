# Migration `20201022203707-initial`

This migration has been generated by Ayush Goyal at 10/22/2020, 4:37:07 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Budget" (
"id" SERIAL,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Category" (
"id" SERIAL,
"name" text   NOT NULL ,
"budgetId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."LineItem" (
"id" SERIAL,
"name" text   NOT NULL ,
"quantity" integer   NOT NULL ,
"unitCost" Decimal(65,30)   NOT NULL ,
"categoryId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."OperatingBudget" (
"id" SERIAL,
"month" text   NOT NULL ,
"year" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."OperatingLineItem" (
"id" SERIAL,
"name" text   NOT NULL ,
"cost" Decimal(65,30)   NOT NULL ,
"operatingBudgetId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Approval" (
"id" SERIAL,
"isApproving" boolean   NOT NULL ,
"notes" text   NOT NULL ,
"date" text   NOT NULL ,
"approverId" integer   NOT NULL ,
"requisitionId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."File" (
"id" SERIAL,
"name" text   NOT NULL ,
"googleName" text   NOT NULL ,
"isActive" boolean   NOT NULL ,
"requisitionId" integer   NOT NULL ,
"type" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Payment" (
"id" SERIAL,
"amount" Decimal(65,30)   NOT NULL ,
"fundingSourceId" integer   NOT NULL ,
"requisitionId" integer   NOT NULL ,
"recipientId" integer   NOT NULL ,
"date" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."PaymentMethod" (
"id" SERIAL,
"name" text   NOT NULL ,
"isActive" boolean   NOT NULL ,
"reimbursementInstructions" text   NOT NULL ,
"isDirectPayment" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Project" (
"id" SERIAL,
"name" text   NOT NULL ,
"archived" boolean   NOT NULL ,
"shortCode" text   NOT NULL ,
"year" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Requisition" (
"id" SERIAL,
"headline" text   NOT NULL ,
"description" text   NOT NULL ,
"status" text   NOT NULL ,
"projectId" integer   NOT NULL ,
"vendorId" integer   ,
"projectRequisitionId" integer   NOT NULL ,
"createdById" integer   NOT NULL ,
"paymentRequiredBy" text   ,
"otherFees" Decimal(65,30)   ,
"orderDate" text   ,
"shippingLocation" text   NOT NULL ,
"isReimbursement" boolean   NOT NULL ,
"fundingSourceId" integer   ,
"budgetId" integer   ,
"purchaseDate" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RequisitionItem" (
"id" SERIAL,
"name" text   NOT NULL ,
"quantity" integer   ,
"unitPrice" Decimal(65,30)   ,
"requisitionId" integer   NOT NULL ,
"link" text   NOT NULL ,
"notes" text   NOT NULL ,
"received" boolean   NOT NULL ,
"lineItemId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Vendor" (
"id" SERIAL,
"name" text   NOT NULL ,
"isActive" boolean   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" SERIAL,
"uuid" text   NOT NULL ,
"name" text   NOT NULL ,
"email" text   NOT NULL ,
"token" text   NOT NULL ,
"accessLevel" text   NOT NULL ,
"slackId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_ProjectToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "File.googleName_unique" ON "public"."File"("googleName")

CREATE UNIQUE INDEX "PaymentMethod.name_unique" ON "public"."PaymentMethod"("name")

CREATE UNIQUE INDEX "Vendor.name_unique" ON "public"."Vendor"("name")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "_ProjectToUser_AB_unique" ON "public"."_ProjectToUser"("A", "B")

CREATE INDEX "_ProjectToUser_B_index" ON "public"."_ProjectToUser"("B")

ALTER TABLE "public"."Category" ADD FOREIGN KEY ("budgetId")REFERENCES "public"."Budget"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."LineItem" ADD FOREIGN KEY ("categoryId")REFERENCES "public"."Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."OperatingLineItem" ADD FOREIGN KEY ("operatingBudgetId")REFERENCES "public"."OperatingBudget"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Approval" ADD FOREIGN KEY ("approverId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Approval" ADD FOREIGN KEY ("requisitionId")REFERENCES "public"."Requisition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("requisitionId")REFERENCES "public"."Requisition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Payment" ADD FOREIGN KEY ("fundingSourceId")REFERENCES "public"."PaymentMethod"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Payment" ADD FOREIGN KEY ("recipientId")REFERENCES "public"."Vendor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Payment" ADD FOREIGN KEY ("requisitionId")REFERENCES "public"."Requisition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Requisition" ADD FOREIGN KEY ("budgetId")REFERENCES "public"."Budget"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Requisition" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Requisition" ADD FOREIGN KEY ("fundingSourceId")REFERENCES "public"."PaymentMethod"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Requisition" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Requisition" ADD FOREIGN KEY ("vendorId")REFERENCES "public"."Vendor"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RequisitionItem" ADD FOREIGN KEY ("lineItemId")REFERENCES "public"."LineItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RequisitionItem" ADD FOREIGN KEY ("requisitionId")REFERENCES "public"."Requisition"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Project"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ProjectToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201022203707-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,164 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Budget {
+  id           Int           @id @default(autoincrement())
+  name         String
+  categories   Category[]
+  requisitions Requisition[]
+}
+
+model Category {
+  id        Int        @id @default(autoincrement())
+  name      String
+  budgetId  Int
+  budget    Budget     @relation(fields: [budgetId], references: [id])
+  lineItems LineItem[]
+}
+
+model LineItem {
+  id              Int               @id @default(autoincrement())
+  name            String
+  quantity        Int
+  unitCost        Float
+  categoryId      Int
+  category        Category          @relation(fields: [categoryId], references: [id])
+  requisitionItem RequisitionItem[]
+}
+
+model OperatingBudget {
+  id                 Int                 @id @default(autoincrement())
+  month              String
+  year               Int
+  operatingLineItems OperatingLineItem[]
+}
+
+model OperatingLineItem {
+  id                Int             @id @default(autoincrement())
+  name              String
+  cost              Float
+  operatingBudgetId Int
+  OperatingBudget   OperatingBudget @relation(fields: [operatingBudgetId], references: [id])
+}
+
+model Approval {
+  id            Int         @id @default(autoincrement())
+  isApproving   Boolean
+  notes         String
+  date          String
+  approverId    Int
+  requisitionId Int
+  approver      User        @relation(fields: [approverId], references: [id])
+  requisition   Requisition @relation(fields: [requisitionId], references: [id])
+}
+
+model File {
+  id            Int         @id @default(autoincrement())
+  name          String
+  googleName    String      @unique
+  isActive      Boolean
+  requisitionId Int
+  type          String
+  requisition   Requisition @relation(fields: [requisitionId], references: [id])
+}
+
+model Payment {
+  id              Int           @id @default(autoincrement())
+  amount          Float
+  fundingSourceId Int
+  requisitionId   Int
+  recipientId     Int
+  date            String
+  paymentMethod   PaymentMethod @relation(fields: [fundingSourceId], references: [id])
+  vendor          Vendor        @relation(fields: [recipientId], references: [id])
+  requisition     Requisition   @relation(fields: [requisitionId], references: [id])
+}
+
+model PaymentMethod {
+  id                        Int           @id @default(autoincrement())
+  name                      String        @unique
+  isActive                  Boolean
+  reimbursementInstructions String
+  isDirectPayment           Boolean
+  payment                   Payment[]
+  expenses_requisition      Requisition[]
+}
+
+model Project {
+  id           Int           @id @default(autoincrement())
+  name         String
+  archived     Boolean
+  shortCode    String
+  year         Int
+  projectLeads User[]
+  requisition  Requisition[]
+}
+
+model Requisition {
+  id                   Int               @id @default(autoincrement())
+  headline             String
+  description          String
+  status               String
+  projectId            Int
+  vendorId             Int?
+  projectRequisitionId Int
+  createdById          Int
+  paymentRequiredBy    String?
+  otherFees            Float?
+  orderDate            String?
+  shippingLocation     String
+  isReimbursement      Boolean
+  fundingSourceId      Int?
+  budgetId             Int?
+  purchaseDate         String?
+  budget               Budget?           @relation(fields: [budgetId], references: [id])
+  createdBy            User              @relation(fields: [createdById], references: [id])
+  paymentMethod        PaymentMethod?    @relation(fields: [fundingSourceId], references: [id])
+  project              Project           @relation(fields: [projectId], references: [id])
+  vendor               Vendor?           @relation(fields: [vendorId], references: [id])
+  approvals            Approval[]
+  files                File[]
+  payments             Payment[]
+  items                RequisitionItem[]
+}
+
+model RequisitionItem {
+  id            Int         @id @default(autoincrement())
+  name          String
+  quantity      Int?
+  unitPrice     Float?
+  requisitionId Int
+  link          String
+  notes         String
+  received      Boolean
+  lineItemId    Int?
+  lineItem      LineItem?   @relation(fields: [lineItemId], references: [id])
+  requisition   Requisition @relation(fields: [requisitionId], references: [id])
+}
+
+model Vendor {
+  id           Int           @id @default(autoincrement())
+  name         String        @unique
+  isActive     Boolean
+  payments     Payment[]
+  requisitions Requisition[]
+}
+
+model User {
+  id           Int           @id @default(autoincrement())
+  uuid         String
+  name         String
+  email        String        @unique
+  token        String
+  accessLevel  String
+  slackId      String
+  approvals    Approval[]
+  projects     Project[]
+  requisitions Requisition[]
+}
```


